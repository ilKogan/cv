<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Космическое Радио</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Arial', sans-serif;
      color: white;
    }

    .space {
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
      z-index: -2;
    }

    .stars {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle var(--duration) infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }

    .radio-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .play-button {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.3s;
      box-shadow: 0 0 15px rgba(0, 150, 255, 0.5);
      z-index: 20;
      margin-bottom: 20px;
    }

    .play-button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 25px rgba(0, 150, 255, 0.8);
    }

    .play-button::before,
    .play-button::after {
      content: '';
      position: absolute;
      border-radius: 50%;
      border: 1px solid rgba(0, 150, 255, 0.5);
      animation: pulse 2s infinite;
    }

    .play-button::before {
      width: 90px;
      height: 90px;
    }

    .play-button::after {
      width: 100px;
      height: 100px;
      border-color: rgba(0, 150, 255, 0.3);
      animation-duration: 3s;
    }

    @keyframes pulse {
      0% { transform: scale(0.8); opacity: 0.7; }
      70% { transform: scale(1.2); opacity: 0; }
      100% { opacity: 0; }
    }

    .play-icon {
      width: 0;
      height: 0;
      border-top: 15px solid transparent;
      border-bottom: 15px solid transparent;
      border-left: 22px solid white;
    }

    .pause-icon {
      width: 22px;
      height: 30px;
      display: flex;
      justify-content: space-between;
    }

    .pause-icon::before,
    .pause-icon::after {
      content: '';
      width: 6px;
      height: 100%;
      background: white;
    }

    .halo {
      position: absolute;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(0, 150, 255, 0.2) 0%, rgba(0, 150, 255, 0) 70%);
      z-index: 5;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
    }

    .title {
      font-size: 18px;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 8px rgba(0, 150, 255, 0.7);
      margin-bottom: 10px;
      text-align: center;
    }

    .status {
      font-size: 12px;
      opacity: 0.7;
      text-align: center;
      margin-bottom: 20px;
    }

    .spectrum-container {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 5px;
      width: 90%;
      max-width: 300px;
      height: 60px;
      margin-bottom: 20px;
    }

    .spectrum-left,
    .spectrum-right {
      display: flex;
      flex-direction: row;
      align-items: flex-end;
      height: 100%;
    }

    .spectrum-left {
      flex-direction: row-reverse;
    }

    .spectrum-right {
      transform: scaleX(-1);
    }

    .spectrum-bar {
      width: 3px;
      margin: 0 0.5px;
      background: linear-gradient(to top, #00a2ff, #00ffe9);
      border-radius: 2px;
      transform-origin: bottom center;
      transition: height 0.1s ease-out, opacity 0.1s ease-out;
      box-shadow: 0 0 5px rgba(0, 162, 255, 0.7);
      opacity: 0.3;
    }

    /* Адаптация под мобильные */
    @media (max-height: 500px), (max-width: 480px) {
      .play-button {
        width: 60px;
        height: 60px;
      }

      .play-icon {
        border-top: 12px solid transparent;
        border-bottom: 12px solid transparent;
        border-left: 18px solid white;
      }

      .spectrum-container {
        height: 40px;
      }

      .spectrum-bar {
        width: 2px;
        margin: 0 0.3px;
      }

      .title {
        font-size: 16px;
      }

      .status {
        font-size: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="space"></div>
  <div class="stars"></div>
  <div class="radio-wrapper">
    <div class="halo"></div>
    <div class="spectrum-container">
      <div class="spectrum-left" id="spectrumLeft"></div>
      <div class="spectrum-right" id="spectrumRight"></div>
    </div>
    <div class="play-button" id="playButton">
      <div class="play-icon" id="playIcon"></div>
    </div>
    <div class="title">Космическое Радио</div>
    <div class="status" id="status">Нажмите для запуска</div>
  </div>
  <audio id="audio" crossorigin="anonymous"></audio>

  <script>
    const starsContainer = document.querySelector('.stars');
    const starCount = window.innerWidth <= 600 ? 80 : 200;
    for (let i = 0; i < starCount; i++) {
      const star = document.createElement('div');
      star.classList.add('star');
      const size = Math.random() * 2;
      const x = Math.random() * 100;
      const y = Math.random() * 100;
      const duration = 2 + Math.random() * 3;
      star.style.width = `${size}px`;
      star.style.height = `${size}px`;
      star.style.left = `${x}%`;
      star.style.top = `${y}%`;
      star.style.setProperty('--duration', `${duration}s`);
      starsContainer.appendChild(star);
    }

    const spectrumLeft = document.getElementById('spectrumLeft');
    const spectrumRight = document.getElementById('spectrumRight');
    const barCount = 40;

    for (let i = 0; i < barCount; i++) {
      const barLeft = document.createElement('div');
      barLeft.classList.add('spectrum-bar');
      barLeft.style.height = `${5 + Math.random() * 10}px`;
      spectrumLeft.appendChild(barLeft);

      const barRight = document.createElement('div');
      barRight.classList.add('spectrum-bar');
      barRight.style.height = `${5 + Math.random() * 10}px`;
      spectrumRight.appendChild(barRight);
    }

    const audio = document.getElementById('audio');
    const playButton = document.getElementById('playButton');
    const playIcon = document.getElementById('playIcon');
    const statusElement = document.getElementById('status');
    const halo = document.querySelector('.halo');
    const spectrumBarsLeft = document.querySelectorAll('#spectrumLeft .spectrum-bar');
    const spectrumBarsRight = document.querySelectorAll('#spectrumRight .spectrum-bar');

    let isPlaying = false;
    let audioContext, analyser, dataArray;
    let animationId;

    const radioStreamUrl = 'https://a8.radioheart.ru:9042/RH55620 ';
    const corsProxy = 'https://cors-anywhere.herokuapp.com/ ';
    const proxiedStreamUrl = corsProxy + radioStreamUrl;

    playButton.addEventListener('click', togglePlay);

    function togglePlay() {
      if (isPlaying) stopRadio();
      else startRadio();
    }

    function startRadio() {
      statusElement.textContent = 'Подключаемся...';
      audio.src = proxiedStreamUrl;
      audio.crossOrigin = 'anonymous';

      const onPlaySuccess = () => {
        isPlaying = true;
        playIcon.innerHTML = '<div class="pause-icon"></div>';
        statusElement.textContent = 'Соединение установлено';
        setupAudioAnalyser();
      };

      const onPlayError = (error) => {
        console.error('Ошибка воспроизведения:', error);
        statusElement.textContent = 'Ошибка подключения. Попробуйте ещё раз.';
        if (audio.src !== radioStreamUrl) {
          statusElement.textContent = 'Пробуем прямое подключение...';
          audio.src = radioStreamUrl;
          audio.play().then(onPlaySuccess).catch(() => {
            statusElement.textContent = 'Не удалось подключиться к радиостанции';
          });
        }
      };

      const playPromise = audio.play();
      if (playPromise !== undefined) {
        playPromise.then(onPlaySuccess).catch(onPlayError);
      }
    }

    function setupAudioAnalyser() {
      if (!window.AudioContext && !window.webkitAudioContext) {
        console.warn('Web Audio API не поддерживается');
        return;
      }
      try {
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        audioContext = new AudioContext();
        const source = audioContext.createMediaElementSource(audio);
        analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;
        source.connect(analyser);
        analyser.connect(audioContext.destination);
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        animate();
      } catch (error) {
        console.error('Ошибка AudioContext:', error);
      }
    }

    function stopRadio() {
      audio.pause();
      isPlaying = false;
      playIcon.innerHTML = '<div class="play-icon"></div>';
      statusElement.textContent = 'Воспроизведение остановлено';
      if (audioContext) {
        audioContext.close().catch(e => console.log(e));
        audioContext = null;
      }
      cancelAnimationFrame(animationId);
      spectrumBarsLeft.forEach(bar => {
        bar.style.height = `${5 + Math.random() * 10}px`;
        bar.style.opacity = '0.3';
      });
      spectrumBarsRight.forEach(bar => {
        bar.style.height = `${5 + Math.random() * 10}px`;
        bar.style.opacity = '0.3';
      });
      halo.style.opacity = '0';
    }

    function animate() {
      animationId = requestAnimationFrame(animate);
      if (!analyser) return;
      analyser.getByteFrequencyData(dataArray);
      const bass = dataArray[0] / 255;
      halo.style.opacity = bass.toString();
      halo.style.transform = `scale(${1 + bass * 0.5})`;

      spectrumBarsLeft.forEach((bar, i) => {
        const index = Math.floor(i * (dataArray.length / barCount));
        const value = dataArray[index] / 255;
        const height = 5 + value * 50;
        bar.style.height = `${height}px`;
        bar.style.opacity = 0.3 + value * 0.7;
        const hue = 180 + value * 60;
        bar.style.background = `linear-gradient(to top, hsl(${hue}, 100%, 50%), hsl(190, 100%, 50%)`;
        bar.style.boxShadow = `0 0 ${2 + value * 6}px hsl(${hue}, 100%, 50%)`;
      });

      spectrumBarsRight.forEach((bar, i) => {
        const mirrorIndex = barCount - i - 1;
        const value = dataArray[Math.floor(mirrorIndex * (dataArray.length / barCount))] / 255;
        const height = 5 + value * 50;
        bar.style.height = `${height}px`;
        bar.style.opacity = 0.3 + value * 0.7;
        const hue = 180 + value * 60;
        bar.style.background = `linear-gradient(to top, hsl(${hue}, 100%, 50%), hsl(190, 100%, 50%)`;
        bar.style.boxShadow = `0 0 ${2 + value * 6}px hsl(${hue}, 100%, 50%)`;
      });
    }
  </script>
</body>
</html>